psql.js

Databaseクラス
<<メソッド一覧>>
async chNameFromSymToDir(引数: シンボリックリンク名)
シンボリックリンクのシーケンスコードをDBに問い合わせ。
シンボリックリンクの実体となる親ディレクトリのシーケンスコードに変換。
親ディレクトリ名に変換。
親ディレクトリ名を返す。

async getFiles(引数: ディレクトリエントリオブジェクト, ユーザID, レスポンス用オブジェクト)
シンボリックリンクなら親ディレクトリ名に名前変換(chNameFromSymToDirメソッド)。
ディレクトリ名をDB(getEntry)に渡し、ディレクトリエントリ配列を取得。
所有者と実行ユーザーのIDを照会し、適切な権限コードを取得。
権限コードから実行可能コマンド一覧を取得(getInfo())。
ファイルタイプからファイルタイプ名を取得(getType)。
ディレクトリエントリ配列、実行可能コマンド一覧、ファイルタイプ名を格納したディレクトリオブジェクトを作成し、files配列に格納。
files配列を返す。

async deleteFile(引数:ファイルオブジェクト, responseオブジェクト)
ディレクトリの場合、ディレクトリ以下のファイルを全てデータベースから削除。
それ以外はファイル名に合致するファイルをDBから削除する。
削除メッセージの送信。

async createDir(引数: uid, ファイル名)
FILESテーブルにファイル名、uid、B'00111111111'を渡してインサート文発行。
成功可否を返す。

async searchExecCode(引数: ファイルのidとファイルの種別)
ファイルの種別を種別コードに変換(getTcode())。
idをDBに渡してcattrを取得(getCattr())。
種別コード上3桁とcattrからattr_codeを生成。
id, attr_codeより実行コード(ecode)を取得し、返す。


async setFile(引数: ファイル名, 所有者id, ファイル種別)
DBの FILESテーブルにインサート。
